<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Vanessa McHale" />
  <title>Apple by Example</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
  </style>
  <script
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"
  type="text/javascript"></script>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Apple by Example</h1>
<p class="author">Vanessa McHale</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#introduction" id="toc-introduction">Introduction</a>
<ul>
<li><a href="#installation" id="toc-installation">Installation</a>
<ul>
<li><a href="#libraries" id="toc-libraries">Libraries</a></li>
</ul></li>
<li><a href="#reference-card" id="toc-reference-card">Reference
Card</a></li>
</ul></li>
<li><a href="#capabilities" id="toc-capabilities">Capabilities</a>
<ul>
<li><a href="#integer-range" id="toc-integer-range">Integer
range</a></li>
<li><a href="#map" id="toc-map">Map</a></li>
<li><a href="#fold" id="toc-fold">Fold</a></li>
<li><a href="#array-literals" id="toc-array-literals">Array
Literals</a></li>
<li><a href="#reverse" id="toc-reverse">Reverse</a></li>
<li><a href="#outer-product" id="toc-outer-product">Outer
Product</a></li>
</ul></li>
<li><a href="#examples" id="toc-examples">Examples</a>
<ul>
<li><a href="#dot-product" id="toc-dot-product">Dot Product</a></li>
<li><a href="#rising-factorial" id="toc-rising-factorial">Rising
Factorial</a></li>
<li><a href="#kullback-leibler-divergence"
id="toc-kullback-leibler-divergence">Kullback-Leibler
Divergence</a></li>
<li><a href="#shoelace-theorem" id="toc-shoelace-theorem">Shoelace
Theorem</a></li>
<li><a href="#polynomials" id="toc-polynomials">Polynomials</a>
<ul>
<li><a href="#evaluation" id="toc-evaluation">Evaluation</a></li>
</ul></li>
<li><a href="#array" id="toc-array">Array</a>
<ul>
<li><a href="#filter" id="toc-filter">Filter</a></li>
</ul></li>
<li><a href="#numerics" id="toc-numerics">Numerics</a>
<ul>
<li><a href="#arithmetic-geometric-mean"
id="toc-arithmetic-geometric-mean">Arithmetic-Geometric Mean</a></li>
<li><a href="#hypergeometric-function"
id="toc-hypergeometric-function">Hypergeometric Function</a></li>
</ul></li>
<li><a href="#geography" id="toc-geography">Geography</a>
<ul>
<li><a href="#mercator" id="toc-mercator">Mercator</a></li>
</ul></li>
<li><a href="#number-theory" id="toc-number-theory">Number Theory</a>
<ul>
<li><a href="#primality-check" id="toc-primality-check">Primality
Check</a></li>
<li><a href="#radical" id="toc-radical">Radical</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
<h1 id="introduction">Introduction</h1>
<p>Apple is an experimental compiler with a working though
not-perfectly-designed typed frontend.</p>
<h2 id="installation">Installation</h2>
<p>The REPL and typechecker are available on the <a
href="https://github.com/vmchale/apple/releases">release page</a>.</p>
<h3 id="libraries">Libraries</h3>
<p>To install the libraries, you can use <a
href="https://www.haskell.org/ghcup/">ghcup</a> to install cabal and
GHC.</p>
<p>Then:</p>
<pre><code>make
sudo make install-lib</code></pre>
<p>To install the Python extension module:</p>
<pre><code>make install-py</code></pre>
<h2 id="reference-card">Reference Card</h2>
<p>In the REPL, type <code>\l</code>.</p>
<pre><code> &gt; \l
Î›             scan                     âˆš             sqrt
â‹‰             max                      â‹Š             min
â³             integer range            âŒŠ             floor
â„¯             exp                      â¨³ {m,n}       convolve
\~            successive application   \`n           dyadic infix
_.            log                      &#39;n            map
`             zip                      `{i,jâˆ˜[k,l]}  rank
ğ’»             range (real)             ğœ‹             pi

â‹®</code></pre>
<p>Use <code>:ty</code> for more:</p>
<pre><code> &gt; :ty (âŠ²)
a â†’ Vec i a â†’ Vec (i + 1) a</code></pre>
<h1 id="capabilities">Capabilities</h1>
<h2 id="integer-range">Integer range</h2>
<p>To generate an integer range use <code>irange</code> or
<code>â³</code> (APL iota).</p>
<pre><code> &gt; â³
â³ : int â†’ int â†’ int â†’ Vec #n int</code></pre>
<p><code>â³</code> takes a start value, end value, and step size as
arguments, viz.</p>
<pre><code> &gt; â³ 0 9 1
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
 &gt; irange 30 0 _3
[30, 27, 24, 21, 18, 15, 12, 9, 6, 3, 0]</code></pre>
<h2 id="map">Map</h2>
<p><code>'</code> maps over an array.</p>
<pre><code> &gt; (*2)&#39;â³ 0 9 1
[0, 2, 4, 6, 8, 10, 12, 14, 16, 18]</code></pre>
<p>Functions can be <a
href="https://wiki.haskell.org/Currying">curried</a>.</p>
<h2 id="fold">Fold</h2>
<p><code>/</code> folds over an array.</p>
<pre><code> &gt; (+)/â³ 1 100 1
5050</code></pre>
<h2 id="array-literals">Array Literals</h2>
<p>Array literals are delineated by <code>âŸ¨</code>â€¦<code>âŸ©</code>.</p>
<pre><code> &gt; âŸ¨1,0::intâŸ©
[1, 0]</code></pre>
<p>For a higher-dimensional array:</p>
<pre><code> &gt; âŸ¨âŸ¨0,1âŸ©,âŸ¨1,0::intâŸ©âŸ©
[ [0, 1]
, [1, 0] ]</code></pre>
<h2 id="reverse">Reverse</h2>
<p><code>~</code> reverses an array.</p>
<pre><code> &gt; ~(irange 0 9 1)
[9, 8, 7, 6, 5, 4, 3, 2, 1, 0]
 &gt; irange 9 0 _1
[9, 8, 7, 6, 5, 4, 3, 2, 1, 0]</code></pre>
<p>Note that we can map over an array.</p>
<pre><code> &gt; ~&#39;âŸ¨âŸ¨0,1âŸ©,âŸ¨1,0::intâŸ©âŸ©
[ [1, 0]
, [0, 1] ]</code></pre>
<p>Reverse applied to a higher-dimensional array reverses elements
(sub-arrays) along the first dimension.</p>
<pre><code> &gt; âŸ¨âŸ¨0,1âŸ©,âŸ¨1,0::intâŸ©,âŸ¨2,4âŸ©âŸ©
[ [0, 1]
, [1, 0]
, [2, 4] ]
 &gt; ~âŸ¨âŸ¨0,1âŸ©,âŸ¨1,0::intâŸ©,âŸ¨2,4âŸ©âŸ©
[ [2, 4]
, [1, 0]
, [0, 1] ]</code></pre>
<h2 id="outer-product">Outer Product</h2>
<p>The outer product <code>âŠ—</code> creates a table by applying some
function.</p>
<p>It has type</p>
<pre><code> &gt; :ty \f.\x.\y. x fâŠ— y
(a â†’ b â†’ c) â†’ Arr sh0 a â†’ Arr sh1 b â†’ Arr (sh0 â§º sh1) c</code></pre>
<pre><code> &gt; (frange 0 9 10) (*)âŠ— (frange 0 9 10)
[ [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
, [0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0]
, [0.0, 2.0, 4.0, 6.0, 8.0, 10.0, 12.0, 14.0, 16.0, 18.0]
, [0.0, 3.0, 6.0, 9.0, 12.0, 15.0, 18.0, 21.0, 24.0, 27.0]
, [0.0, 4.0, 8.0, 12.0, 16.0, 20.0, 24.0, 28.0, 32.0, 36.0]
, [0.0, 5.0, 10.0, 15.0, 20.0, 25.0, 30.0, 35.0, 40.0, 45.0]
, [0.0, 6.0, 12.0, 18.0, 24.0, 30.0, 36.0, 42.0, 48.0, 54.0]
, [0.0, 7.0, 14.0, 21.0, 28.0, 35.0, 42.0, 49.0, 56.0, 63.0]
, [0.0, 8.0, 16.0, 24.0, 32.0, 40.0, 48.0, 56.0, 64.0, 72.0]
, [0.0, 9.0, 18.0, 27.0, 36.0, 45.0, 54.0, 63.0, 72.0, 81.0] ]</code></pre>
<pre><code> &gt; (frange 0 4 5) [(x,y)]âŠ— (frange 0 4 5)
[ [(0.0*0.0), (0.0*1.0), (0.0*2.0), (0.0*3.0), (0.0*4.0)]
, [(1.0*0.0), (1.0*1.0), (1.0*2.0), (1.0*3.0), (1.0*4.0)]
, [(2.0*0.0), (2.0*1.0), (2.0*2.0), (2.0*3.0), (2.0*4.0)]
, [(3.0*0.0), (3.0*1.0), (3.0*2.0), (3.0*3.0), (3.0*4.0)]
, [(4.0*0.0), (4.0*1.0), (4.0*2.0), (4.0*3.0), (4.0*4.0)] ]</code></pre>
<h1 id="examples">Examples</h1>
<h2 id="dot-product">Dot Product</h2>
<pre><code>[(+)/ ((*)`((x::Vec n float)) y)]</code></pre>
<p><code>/</code> is fold and ` is zip. Note that we must provide a type
annotation</p>
<p>We can inspect the assembly:</p>
<pre><code> &gt; :asm [(+)/ ((*)`((x::Vec n float)) y)]

    ldr x4, [x0, #0x8]
    ldr d3, [x0, #0x10]
    ldr d2, [x1, #0x10]
    fmul d0, d3, d2
    mov x2, #0x1
    cmp x2, x4
    b.GE apple_1
apple_0:
    add x3, x2, #0x2
    ldr d3, [x0, x3, LSL #3]
    add x3, x2, #0x2
    ldr d2, [x1, x3, LSL #3]
    fmadd d0, d3, d2, d0
    add x2, x2, #0x1
    cmp x2, x4
    b.LT apple_0
apple_1:
    ret</code></pre>
<h2 id="rising-factorial">Rising Factorial</h2>
<p>The <a
href="https://mathworld.wolfram.com/RisingFactorial.html">rising
factorial</a> is defined as:</p>
<p><span class="math display">\[ x^{(n)} = x(x+1)\cdots
(x+n-1)\]</span></p>
<p>In apple this is</p>
<pre><code>[(*)/â‚’ 1 (â³ x (x+y-1) 1)]</code></pre>
<p><code>/â‚’</code> is a ternary operator, fold with seed.</p>
<h2 id="kullback-leibler-divergence">Kullback-Leibler Divergence</h2>
<pre><code>Î»p.Î»q. (+)/([x*_.(x%y)]`p q)</code></pre>
<h2 id="shoelace-theorem">Shoelace Theorem</h2>
<pre><code>Î»as.Î»bs.
    { sum â‡ [(+)/x]
    ; 0.5*abs.(sum((*)`as (1âŠ–bs)) - sum((*)`(1âŠ–as) bs))
    }</code></pre>
<h2 id="polynomials">Polynomials</h2>
<h3 id="evaluation">Evaluation</h3>
<pre><code>Î»p.Î»x. (+)/ ((*)`(~p) (gen. 1 (*x) (ğ“‰p)))</code></pre>
<h2 id="array">Array</h2>
<p>To take all but the last 6 elements:</p>
<pre><code>[{.\`7 x]</code></pre>
<p>To drop the first 6 elements:</p>
<pre><code>[}.\`7 x]</code></pre>
<h3 id="filter">Filter</h3>
<pre><code>\p.\xs. (xsË™)&#39;pâ©ªxs</code></pre>
<h2 id="numerics">Numerics</h2>
<h3 id="arithmetic-geometric-mean">Arithmetic-Geometric Mean</h3>
<pre><code>Î»x.Î»y.([{aâŸœx-&gt;1;gâŸœx-&gt;2;((a+g)%2,âˆš(a*g))}]^:6 (x,y))-&gt;1</code></pre>
<p>Thence the <a
href="https://en.wikipedia.org/wiki/Elliptic_integral#Complete_elliptic_integral_of_the_first_kind">complete
elliptic integral of the first kind</a>:</p>
<pre><code>Î»k.
{
  agm â† Î»x.Î»y.([{aâŸœx-&gt;1;gâŸœx-&gt;2;((a+g)%2,âˆš(a*g))}]^:6 (x,y))-&gt;1;
  ğœ‹%(2*agm 1 (âˆš(1-k^2)))
}</code></pre>
<p>Gaussâ€™ approximation of the logarithm:</p>
<pre><code>Î»m.Î»x.
{
  amgm â† Î»x.Î»y.([{aâŸœx-&gt;1;gâŸœx-&gt;2;((a+g)%2,âˆš(a*g))}]^:15 (x,y))-&gt;1;
  -- m&gt;2
  ğœ‹%(2*amgm 1 (0.5^(m-2)%x))-â„ m*0.6931471805599453
}</code></pre>
<h3 id="hypergeometric-function">Hypergeometric Function</h3>
<p><span class="math display">\[
{}_pF_q(a_1,\ldots,a_p;b_1,\ldots,b_q;x) = \sum_{n=0}^\infty
\frac{(a_1)_n\ldots (a_p)_n}{(b_1)_n\ldots
(b_q)_n}\frac{x^n}{n!}\]</span></p>
<p>where <span class="math inline">\((x)_n\)</span> is the <a
href="#rising-factorial">rising factorial</a> above.</p>
<pre><code>Î»a.Î»b.Î»z.
{
  rf â† [(*)/â‚’ 1 (ğ’» x (x+y-1) (âŒŠy))]; fact â† rf 1;
  Î£ â† Î»N.Î»a. (+)/â‚’ 0 (a&#39;(â³ 0 N 1)); Î  â† [(*)/x];
  Î£ 30 (Î»n. {nnâŸœâ„ n; (Î  ((Î»a.rf a nn)&#39;a)%Î ((Î»b. rf b nn)&#39;b))*(z^n%fact nn)})
}</code></pre>
<p>We can use the REPL to inspect the type:</p>
<pre><code> &gt; :yank H math/hypergeometric.ğŸ
 &gt; :ty H
Vec (i + 1) float â†’ Vec (i + 1) float â†’ float â†’ float</code></pre>
<h2 id="geography">Geography</h2>
<h3 id="mercator">Mercator</h3>
<p><span class="math display">\[ x \mapsto \lambda - \lambda_0 \]</span>
<span class="math display">\[ y \mapsto \frac{1}{2}
\log{\left(\frac{1+\sin \phi}{1-\sin \phi}\right)} \]</span></p>
<pre><code>\ğœ†â‚€.\ğœ‘.\ğœ†.{aâŸœsin.ğœ‘;(ğœ†-ğœ†â‚€,(_.((1+a)%(1-a)))%2)}</code></pre>
<h2 id="number-theory">Number Theory</h2>
<h3 id="primality-check">Primality Check</h3>
<pre><code>Î»n.Â¬((âˆ¨)/â‚’ #f ([(n|x)=0]&#39;(â³ 2 (âŒŠ(âˆš(â„n))) 1)))</code></pre>
<h3 id="radical">Radical</h3>
<p>Compute the radical of an integer <span
class="math inline">\(n\)</span>, <span
class="math inline">\(\displaystyle \prod_{p|n} p\)</span></p>
<pre><code>Î»n.
  { ni âŸœ âŒŠ(âˆš(â„n))
  ; isPrime â† Î»n.Â¬((âˆ¨)/â‚’ #f ([(n|x)=0]&#39;(â³ 2 (âŒŠ(âˆš(â„n))) 1)))
  ; pf â‡ (isPrime #.)
  ; pps âŸœ  pf ((Î»k. ((n|k)=0)) #. (â³ 2 ni 1))
  ; ?ni^2=n
    ,.((*)/â‚’ 1 (pf ((n/.)&#39;(}:? pps))â§ºpps))
    ,.((*)/â‚’ 1 (pf (n âŠ² ((n/.)&#39;pps))â§ºpps))
  }</code></pre>
</body>
</html>
