Î»trainLabels.Î»trainImages.
{
  x âŸœ  â™­`{3âˆ˜[2,3,4]} (trainImages :: Arr (60000 Ã— 28 Ã— 28 Ã— 1) float);
  targets âŸœ (Î»n.[?x=n,.1::float,.0]'irange 0 9 1)'trainLabels;
  l1init â† ğ”¯ 0 1 :: M â‚‡â‚ˆâ‚„,â‚â‚‚â‚ˆ float;
  l2init â† ğ”¯ 0 1; -- 128Ã—10
  train â†
    Î»l1.Î»l2.
      {
        softmax â† Î»xs.
          { m âŸœ (â‹‰)/* _1 xs; a âŸœ [e:(x-m)]`{0} xs
          ; sum â† [(+)/x]
          ; n âŸœ sum`{1} (a::M float)
          ; â‰([(%x)'y]`{0,1} n a)
          };
        dsoftmax â† Î»xs. [x*(1-x)]`{0} (softmax xs);
        dsigmoid â† ((Î»x.â¸xâŸœâ„¯(_x);x%(1+x)^2)`{0});
        -- fw
        xl1p âŸœ x%.l1;
        xSigmoid â† [1%(1+â„¯(_x))]`{0} xl1p;
        xl2p âŸœ xSigmoid%.l2;
        out â† softmax xl2p;
        -- bw
        error âŸœ (*)`{0,0} ({nâŸœâ„(ğ“‰out); [2*x%n]`{0} ((-)`{0,0} out targets)}) (dsoftmax xl2p);
        ul2 â† (â‰xSigmoid)%.error;
        ul1 â† (â‰x)%.((*)`{0,0} (â‰(l2%.(â‰error))) (dsigmoid xl1p));
        ((+)`{0,0} l1 ul1, (+)`{0,0} l2 ul2)
      };
  [train (x->1) (x->2)]^:2 (l1init,l2init)
}
